# M0.6: Sidecar Packaging Feasibility Spike

**Date:** 2026-02-04
**Status:** ⚠️ INCOMPLETE - Linux-only evidence captured; cross-platform validation pending

## Executive Summary

The OpenVoicy sidecar can be successfully packaged as a standalone binary using PyInstaller on Linux x64. The minimal audio-only build (without ML dependencies) is 57 MB with ~1.3s startup time, well within the acceptance criteria of <500 MB and <5s on that platform. Required Windows/macOS measurements were not captured in this spike and remain open.

## Test Results

### Required Evidence Coverage

| Platform | Evidence Status | Tracking Issue |
|----------|-----------------|----------------|
| Linux x64 | ✅ Measured | This report |
| Windows x64 | ❌ Missing | `translatorvoiceinputtool-18sb` |
| macOS x64 | ❌ Missing | `translatorvoiceinputtool-13k6` |
| macOS arm64 | ❌ Missing | `translatorvoiceinputtool-3nre` |

### Platform: Linux x64 (Ubuntu)

| Metric | Value | Criteria | Status |
|--------|-------|----------|--------|
| Binary Size | 57 MB | <500 MB | ✅ PASS |
| Startup Time | ~1.3s | <5s | ✅ PASS |
| system.ping | Works | Required | ✅ PASS |
| audio.list_devices | Works | Required | ✅ PASS |
| audio.meter_start | Works* | Required | ✅ PASS |

*Returns "no audio device" error in headless environment - PortAudio library successfully included.

### Binary Contents

The packaged binary includes:
- Python 3.13 runtime (embedded)
- NumPy 2.4.2
- SciPy 1.17.0
- sounddevice 0.5.5
- PortAudio 19.6.0 (system library)
- JACK audio libraries (transitive dependency)
- OpenBLAS (for NumPy/SciPy)

### Commands Tested

```bash
# system.ping - SUCCESS
$ echo '{"jsonrpc":"2.0","id":1,"method":"system.ping"}' | ./openvoicy-sidecar
{"jsonrpc":"2.0","id":1,"result":{"version":"0.1.0","protocol":"v1"}}

# audio.list_devices - SUCCESS
$ echo '{"jsonrpc":"2.0","id":2,"method":"audio.list_devices"}' | ./openvoicy-sidecar
{"jsonrpc":"2.0","id":2,"result":{"devices":[]}}

# audio.meter_start - SUCCESS (PortAudio working, no device available)
$ echo '{"jsonrpc":"2.0","id":3,"method":"audio.meter_start"}' | ./openvoicy-sidecar
{"jsonrpc":"2.0","id":3,"error":{"code":-32004,"message":"Error querying device -1","data":{"kind":"E_AUDIO_IO"}}}
```

## Size Projections with ML Dependencies

| Configuration | Estimated Size | Notes |
|--------------|----------------|-------|
| Audio-only (current) | 57 MB | NumPy, SciPy, PortAudio |
| + ONNX Runtime (CPU) | ~150 MB | Recommended for MVP |
| + PyTorch (CPU) | ~400-500 MB | Near size limit |
| + PyTorch (CUDA) | ~2+ GB | Exceeds limit |

**Recommendation:** Use ONNX Runtime for MVP to stay well under 500 MB.

## Native Dependencies

### Linux x64
- libportaudio2 (PortAudio)
- libjack (JACK audio)
- libasound2 (ALSA, typically pre-installed)

### Windows x64 (TBD)
- PortAudio bundled with sounddevice
- No additional system dependencies expected

### macOS (TBD)
- PortAudio bundled with sounddevice
- CoreAudio (system framework)
- May need code signing for Gatekeeper

## Challenges Encountered

1. **Relative Import Issue**: PyInstaller doesn't handle relative imports in `__main__.py`.
   - **Solution:** Created `entry_point.py` wrapper with absolute imports.

2. **PortAudio Not Bundled**: sounddevice looks for system PortAudio at runtime.
   - **Solution:** Explicitly include system library in spec file.

3. **JACK Dependency**: PortAudio pulls in JACK libraries even if not used.
   - **Impact:** Adds ~2 MB to binary size. Acceptable.

## Build Artifacts

```
sidecar/
├── openvoicy_sidecar.spec    # PyInstaller spec file
├── entry_point.py            # Wrapper for PyInstaller
├── dist/
│   └── openvoicy-sidecar     # Standalone binary (57 MB)
└── build/                    # Build artifacts (can be cleaned)
```

## GO/NO-GO Decision

### INCOMPLETE - DO NOT CLOSE CROSS-PLATFORM PACKAGING GATE YET ⚠️

**Rationale:**
1. Linux x64 results are positive (57 MB binary, ~1.3s startup, smoke commands pass)
2. Acceptance criteria require measured evidence for Windows x64, macOS x64, and macOS arm64
3. Those three target-platform measurements are currently missing
4. Cross-platform GO/NO-GO remains blocked until `translatorvoiceinputtool-18sb`, `translatorvoiceinputtool-13k6`, and `translatorvoiceinputtool-3nre` are completed

### Contingency (if ML size becomes issue)

If the full model + ONNX exceeds acceptable size:
1. Use smaller Whisper model (tiny/base instead of parakeet)
2. Download model on first run (not bundled)
3. Stream model from HuggingFace cache

The IPC contract remains unchanged regardless of backend choice.

## Next Steps

1. Complete platform evidence tasks:
   - `translatorvoiceinputtool-18sb` (Windows x64 metrics + smoke evidence)
   - `translatorvoiceinputtool-13k6` (macOS x64 metrics + smoke evidence)
   - `translatorvoiceinputtool-3nre` (macOS arm64 metrics + smoke evidence)
2. **M5.2:** Integrate into Tauri bundling
3. Add ONNX Runtime and test ASR model packaging

## Files Created

- `sidecar/openvoicy_sidecar.spec` - PyInstaller configuration
- `sidecar/entry_point.py` - PyInstaller entry wrapper
- `docs/M0.6-sidecar-packaging-spike.md` - This report
